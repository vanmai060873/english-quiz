<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>English Quiz Pro</title>
<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.question{background:#fff;padding:15px;margin:10px 0;border-radius:8px}
.correct{color:green;font-weight:bold}
.wrong{color:red;font-weight:bold}
button{padding:10px 20px;margin:10px 5px;font-size:16px}
</style>
</head>
<body>

<h2>English Random Quiz</h2>

<div id="quiz"></div>
<button onclick="finishQuiz()">KẾT THÚC</button>
<button onclick="loadNew()">TIẾP TỤC (50 câu khác)</button>

<div id="result"></div>

<script>
let allQuestions=[];
let currentQuestions=[];

fetch("questions.txt")
.then(r=>r.text())
.then(text=>{
    parse(text);
    loadQuiz(60); // CHỈ LOAD 60 CÂU
});

function parse(text){
    let blocks=text.split(/\n\s*\n/);
    blocks.forEach(block=>{
        let lines=block.trim().split("\n");
        if(lines.length>=6){
            allQuestions.push({
                question:lines[0],
                options:lines.slice(1,5),
                answer:lines[5].replace("ANSWER:","").trim()
            });
        }
    });
}

function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
}

function loadQuiz(number){
    document.getElementById("quiz").innerHTML="";
    document.getElementById("result").innerHTML="";

    let randomSet=shuffle([...allQuestions]).slice(0,number);
    currentQuestions=randomSet;

    randomSet.forEach((q,index)=>{
        let div=document.createElement("div");
        div.className="question";
        div.id="q"+index;

        let options=shuffle([...q.options]);

        let html=`<p>${index+1}. ${q.question}</p>`;
        options.forEach(opt=>{
            let letter=opt.charAt(0);
            html+=`
            <label>
            <input type="radio" name="q${index}" value="${letter}">
            ${opt}
            </label><br>`;
        });

        div.innerHTML=html;
        document.getElementById("quiz").appendChild(div);
    });
}

function finishQuiz(){
    let score=0;

    currentQuestions.forEach((q,index)=>{
        let correct=q.answer;
        let selected=document.querySelector(`input[name="q${index}"]:checked`);
        let div=document.getElementById("q"+index);

        div.querySelectorAll("label").forEach(lb=>{
            if(lb.innerText.trim().startsWith(correct)){
                lb.classList.add("correct");
            }
        });

        if(selected){
            if(selected.value===correct){
                score++;
            }else{
                selected.parentElement.classList.add("wrong");
            }
        }
    });

    document.getElementById("result").innerHTML=
        `Kết quả: ${score} / ${currentQuestions.length}`;
}

function loadNew(){
    loadQuiz(50); // LOAD 50 CÂU KHÁC
}
</script>

</body>
</html>
